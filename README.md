# 🚊 지하철 미션

## Pair: 져니 [⛄️](http://github.com/cl8d), 가비 [😊](https://github.com/iamjooon2)

## ✔ 기능 요구사항
**- 역**
  - [x] 역 이름은 최소 3글자부터 최대 10글자까지 가능하다.
  - [x] 역 이름은 중복될 수 없다.

**- 노선**
  - [x] 노선 이름은 최소 3글자부터 최대 10글자까지 가능하다.
  - [x] 노선 이름은 중복될 수 없다.
  - [x] 노선에 대한 추가 요금 정보를 관리한다. 

**- 구간**
  - [x] 시작 역, 끝 역, 거리 정보를 관리한다.
    - [x] 거리 정보는 1 이상이어야 한다.

**- 노선 역 추가**
  - 노선에 역을 추가할 때, 시작 역, 끝 역, 거리 정보를 받는다.
  - [x] 노선에 역 정보가 하나도 존재하지 않는 경우, 기준이 되는 역이 없어도 등록이 가능하다.
    - [x] 노선에 이미 등록된 역 정보가 존재한다면, 시작 역과 끝 역 중 하나는 노선에 존재해야 한다. 아니면 예외가 발생한다.
  - [x] 요청한 끝 역이 상행 종점이라면, 시작 역이 상행 종점이 된다.
  - [x] 요청한 시작 역이 하행 종점이라면, 끝 역이 하행 종점이 된다.
  - 요청한 시작 역이 이미 노선에 존재하는 경우, 존재하는 역의 하행 방향의 가중치와, 입력받은 거리를 비교한다.
    - [x] 만약, 입력받은 거리가 더 크거나 같다면 예외가 발생한다.
    - [x] 입력받은 거리가 더 작다면, 노선에 추가한다. 이때, 끝 역과 하행 방향 역 사이의 가중치는, 기존에 존재하던 가중치에서 입력받은 거리를 뺀 값으로 갱신한다.
  - 요청한 끝 역이 이미 노선에 존재하는 경우, 존재하는 역의 상행 방향의 가중치와, 입력받은 거리를 비교한다.
    - [x] 만약, 입력받은 거리가 더 크거나 같다면 예외가 발생한다.
    - [x] 입력받은 거리가 더 작다면, 노선에 추가한다. 이때, 시작 역과 상행 방향 역 사이의 가중치는, 기존에 존재하던 가중치에서 입력받은 거리를 뺀 값으로 갱신한다.

**-  노선 역 삭제**
  - [x] 상행 종점 혹은 하행 종점이면 그냥 제거한다.
  - [x] 중간에 존재하는 역이라면, 양 옆의 거리를 더하여 가중치를 갱신한다.

**-  노선 조회**
  - [x] 하나의 노선에 존재하는 모든 역을 조회한다.

**-  노선 목록 조회**
  - [x] 존재하는 모든 노선의 역을 조회한다.

**- 데이터베이스 설정 변경**
  - [x] docker 설정
  - [x] 프로덕션, 테스트용 DB 격리

**- 경로 조회**
  - 출발역과 도착역 사이의 최단 거리 경로를 구한다.
    - [x] 출발역부터 도착역까지 가기 위해 사용하는 노선들의 모든 구간 정보를 구한다.
    - [x] 가중치가 가장 작게 되는 출발역 ~ 도착역 구간 정보를 계산한다. (다익스트라 사용)
  - 최단 거리 경로를 사용했을 때 발생하는 비용 정보를 구한다.
    - [x] 거리에 따른 비용 계산 기능을 추가한다.
    - [x] 연령에 따른 비용 계산 기능을 추가한다.

---

### 도커 구동 방법
```
docker-compose -p subway up -d
```

---

### HTTP 요청 가이드
- http 디렉터리를 http client를 활용하여 실행하시면 더 편하게 API 요청을 진행하실 수 있습니다!
- Run With 옵션을 `local`로 설정해 주세요.

### 노선 API (LineController)
- line.http 

|              | HTTP method |              요청 URI              |
|:------------:|:-----------:|:--------------------------------:|
|  **노선 추가**   |    POST     |              /lines              |
|  **구간 추가**   |    POST     |         /lines/sections          |
| **모든 노선 조회** |     GET     |              /lines              |
| **단일 노선 조회** |     GET     |           /lines/{id}            |
| **노선 업데이트**  |     PUT     |           /lines/{id}            |
|  **노선 제거**   |   DELETE    |           /lines/{id}            |
| **노선의 역 제거** |   DELETE    | /lines/{id}/stations/{stationId} |


### 역 조회 API (StationController)
- station.http

|             | HTTP method |              요청 URI              |
|:-----------:|:-----------:|:--------------------------------:|
|  **역 추가**   |    POST     |            /stations             |
| **모든 역 조회** |     GET     |            /stations             |
| **단일 역 조회** |     GET     |          /stations/{id}          |
| **역 업데이트**  |     PUT     |           /stations/{id}            |
|  **역 제거**   |   DELETE    |           /stations/{id}            |


### 경로 조회 API (RouteController)
- route.http  

|              | HTTP method |                      요청 URI                       |
|:------------:|:-----------:|:-------------------------------------------------:|
| **최단 경로 조회** |     GET     | /routes?sourceStationId={id}&targetStationId={id} |
